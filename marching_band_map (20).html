<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>È´òÊ†°„Éû„Éº„ÉÅ„É≥„Ç∞„Éê„É≥„ÉâËß£Ë™¨„Éû„ÉÉ„Éó</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #10B981;
            --primary-dark: #059669;
            --secondary: #34D399;
            --accent: #6EE7B7;
            --bg: #F0FDF4;
            --card-bg: #FFFFFF;
            --text: #064E3B;
            --text-light: #047857;
            --text-muted: #6B7280;
            --overlay: rgba(16, 185, 129, 0.95);
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .controls-overlay {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 15px;
            animation: fadeInDown 0.6s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .add-school-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .add-school-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4);
        }

        .add-school-btn::before {
            content: '+';
            font-size: 1.5rem;
            font-weight: bold;
        }

        .zoom-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .zoom-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease-out;
            border: 3px solid var(--primary);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background: var(--bg);
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text);
            font-weight: 700;
            font-size: 0.9rem;
        }

        input, textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg);
            border: 2px solid #D1FAE5;
            border-radius: 12px;
            color: var(--text);
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .password-section {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 2px solid #F59E0B;
        }

        .password-section p {
            color: #92400E;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .leaflet-popup-content-wrapper {
            background: var(--card-bg);
            color: var(--text);
            border-radius: 16px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: 3px solid var(--primary);
            min-width: 280px;
        }

        .leaflet-popup-content {
            margin: 0;
            width: 100% !important;
        }

        .popup-content {
            padding: 1.5rem;
        }

        .popup-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.8rem;
        }

        .popup-description {
            color: var(--text-muted);
            margin-bottom: 1rem;
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .popup-thumbnail {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            object-fit: cover;
            background: transparent;
        }

        .popup-thumbnail:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.3);
        }

        .leaflet-popup-tip {
            background: var(--card-bg);
            border: 3px solid var(--primary);
            border-top: none;
            border-right: none;
        }

        .custom-marker {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.5);
        }
        
        /* „Ç´„Çπ„Çø„É†„ÇØ„É©„Çπ„Çø„Éº„Ç¢„Ç§„Ç≥„É≥Áî®„ÅÆÂü∫Êú¨„Çπ„Çø„Ç§„É´ */
        .custom-cluster-icon {
            background: transparent !important;
            border: none !important;
        }
        
        .custom-cluster-icon div {
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .custom-cluster-icon div:hover {
            transform: scale(1.1);
        }
        
        /* „Éû„Éº„Ç´„Éº„É©„Éô„É´ÔºàÂ≠¶Ê†°ÂêçÔºâ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .marker-label {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 600;
            color: var(--primary-dark);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            white-space: nowrap;
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        .marker-label::before {
            display: none; /* Áü¢Âç∞„ÇíÈùûË°®Á§∫ */
        }
        
        /* ÂâäÈô§„É¢„Éº„ÉâÁî®„ÅÆ„Çπ„Çø„Ç§„É´ */
        .delete-mode-indicator {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #DC2626 0%, #991B1B 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 8px 30px rgba(220, 38, 38, 0.5);
            z-index: 10000;
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        
        .delete-mode-indicator.active {
            display: block;
        }
        
        /* ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ */
        .delete-confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 20000;
            align-items: center;
            justify-content: center;
        }
        
        .delete-confirm-modal.active {
            display: flex;
        }
        
        .delete-confirm-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            text-align: center;
        }
        
        .delete-confirm-title {
            font-size: 20px;
            font-weight: 700;
            color: #DC2626;
            margin-bottom: 15px;
        }
        
        .delete-confirm-message {
            font-size: 16px;
            color: #374151;
            margin-bottom: 25px;
        }
        
        .delete-confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .delete-confirm-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .delete-confirm-btn.confirm {
            background: #DC2626;
            color: white;
        }
        
        .delete-confirm-btn.confirm:hover {
            background: #991B1B;
        }
        
        .delete-confirm-btn.cancel {
            background: #E5E7EB;
            color: #374151;
        }
        
        .delete-confirm-btn.cancel:hover {
            background: #D1D5DB;
        }
        
        /* „Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç„É¢„Éº„ÉÄ„É´ */
        .password-confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 20000;
            align-items: center;
            justify-content: center;
        }
        
        .password-confirm-modal.active {
            display: flex;
        }
        
        .password-confirm-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
        }
        
        .password-confirm-title {
            font-size: 20px;
            font-weight: 700;
            color: #DC2626;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .password-confirm-description {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .password-confirm-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            transition: border-color 0.3s ease;
        }
        
        .password-confirm-input:focus {
            outline: none;
            border-color: #DC2626;
        }
        
        .password-confirm-error {
            color: #DC2626;
            font-size: 14px;
            margin-bottom: 15px;
            display: none;
            text-align: center;
        }
        
        .password-confirm-error.active {
            display: block;
        }
        
        .password-confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .password-confirm-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .password-confirm-btn.confirm {
            background: #DC2626;
            color: white;
        }
        
        .password-confirm-btn.confirm:hover {
            background: #991B1B;
        }
        
        .password-confirm-btn.cancel {
            background: #E5E7EB;
            color: #374151;
        }
        
        .password-confirm-btn.cancel:hover {
            background: #D1D5DB;
        }
        
        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        /* ÂâäÈô§„É¢„Éº„ÉâÊôÇ„ÅÆ„Éû„Éº„Ç´„Éº„Çπ„Çø„Ç§„É´ */
        .delete-mode .custom-marker {
            background: linear-gradient(135deg, #DC2626 0%, #991B1B 100%);
            cursor: pointer;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(220, 38, 38, 0.5);
            }
            50% {
                box-shadow: 0 6px 20px rgba(220, 38, 38, 0.8);
            }
        }

        /* „ÇØ„É©„Çπ„Çø„ÉºÂÜÖÂÆπË°®Á§∫„É¢„Éº„ÉÄ„É´ */
        .cluster-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 3000;
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .cluster-modal.active {
            display: flex;
        }

        .cluster-modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            display: flex;
            flex-direction: column;
        }

        .cluster-modal-header {
            padding: 20px 30px;
            border-bottom: 2px solid var(--card-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cluster-modal-header h3 {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin: 0;
        }

        .close-cluster-modal {
            background: none;
            border: none;
            font-size: 2rem;
            color: #999;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-cluster-modal:hover {
            background: var(--card-bg);
            color: var(--primary);
        }

        .cluster-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .cluster-school-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .cluster-school-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2);
        }

        .cluster-school-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-dark);
            margin-bottom: 8px;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .cluster-school-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .cluster-school-thumbnail {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 10px;
        }

        .error-message {
            background: #FEE2E2;
            border: 2px solid #DC2626;
            color: #991B1B;
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
            display: none;
            font-weight: 600;
        }

        .success-message {
            background: #D1FAE5;
            border: 2px solid var(--primary);
            color: var(--primary-dark);
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
            display: none;
            font-weight: 600;
        }

        .leaflet-control-zoom {
            display: none !important;
        }
        
        /* „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Éú„Çø„É≥„Å®„Éë„Éç„É´ */
        .filter-overlay {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        /* „É≠„Ç¥Ôºà„Éõ„Éº„É†„Éú„Çø„É≥Ôºâ */
        .logo-home {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .logo-home:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .logo-home img {
            display: block;
            height: 60px;
            width: auto;
        }
        
        /* „Éõ„Éº„É†„Å´Êàª„Çã„Å®„Åç„ÅÆÁôΩ„Éï„É©„ÉÉ„Ç∑„É• */
        .white-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .white-flash.active {
            opacity: 1;
        }
        
        .filter-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4);
        }
        
        .filter-btn::before {
            content: 'üîç';
            font-size: 1.2rem;
        }
        
        .filter-panel {
            position: absolute;
            bottom: 70px;
            left: 0;
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            min-width: 250px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .filter-panel.active {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .filter-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }
        
        .filter-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-item:hover {
            background: #F0FDF4;
        }
        
        .filter-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary);
            border-radius: 6px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .filter-item.active .filter-checkbox {
            background: var(--primary);
        }
        
        .filter-checkbox::after {
            content: '‚úì';
            color: white;
            font-weight: 700;
            font-size: 14px;
            display: none;
        }
        
        .filter-item.active .filter-checkbox::after {
            display: block;
        }
        
        .filter-label {
            font-size: 15px;
            font-weight: 600;
            color: #374151;
        }
        
        .filter-count {
            margin-left: auto;
            font-size: 13px;
            color: #9CA3AF;
            font-weight: 600;
        }
        
        .filter-clear-btn {
            width: 100%;
            padding: 10px;
            background: #F3F4F6;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            color: #6B7280;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .filter-clear-btn:hover {
            background: #E5E7EB;
        }

        @media (max-width: 768px) {
            .controls-overlay {
                top: 10px;
                left: 10px;
                gap: 10px;
            }

            .add-school-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }

            .zoom-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }

            .modal-content {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- ÁôΩ„Éï„É©„ÉÉ„Ç∑„É•„Ç®„Éï„Çß„ÇØ„Éà -->
    <div id="whiteFlash" class="white-flash"></div>

    <!-- „É≠„Ç¥Ôºà„Éõ„Éº„É†„Éú„Çø„É≥Ôºâ -->
    <div class="logo-home" id="logoHome">
        <img src="logo.png" alt="CJMB„ÉÅ„É£„É≥„Éç„É´">
    </div>

    <!-- ÂâäÈô§„É¢„Éº„Éâ„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº -->
    <div id="deleteModeIndicator" class="delete-mode-indicator">
        üóëÔ∏è ÂâäÈô§„É¢„Éº„ÉâÊúâÂäπ - „Éî„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂâäÈô§ (Ctrl+Shift+D„ÅßÁµÇ‰∫Ü)
    </div>

    <!-- „Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç„É¢„Éº„ÉÄ„É´ -->
    <div id="passwordConfirmModal" class="password-confirm-modal">
        <div class="password-confirm-content">
            <div class="password-confirm-title">üîê ÂâäÈô§„É¢„Éº„Éâ</div>
            <div class="password-confirm-description">ÂâäÈô§„É¢„Éº„Éâ„ÇíÊúâÂäπ„Å´„Åô„Çã„Å´„ÅØÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            <input type="password" id="passwordConfirmInput" class="password-confirm-input" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
            <div id="passwordConfirmError" class="password-confirm-error">„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì</div>
            <div class="password-confirm-buttons">
                <button class="password-confirm-btn cancel" id="passwordCancelBtn">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="password-confirm-btn confirm" id="passwordConfirmBtn">Á¢∫Ë™ç</button>
            </div>
        </div>
    </div>

    <!-- ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ -->
    <div id="deleteConfirmModal" class="delete-confirm-modal">
        <div class="delete-confirm-content">
            <div class="delete-confirm-title">‚ö†Ô∏è ÂâäÈô§Á¢∫Ë™ç</div>
            <div class="delete-confirm-message" id="deleteConfirmMessage"></div>
            <div class="delete-confirm-buttons">
                <button class="delete-confirm-btn cancel" id="deleteCancelBtn">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="delete-confirm-btn confirm" id="deleteConfirmBtn">ÂâäÈô§„Åô„Çã</button>
            </div>
        </div>
    </div>

    <div id="map"></div>

    <div class="controls-overlay">
        <div class="zoom-controls">
            <button class="zoom-btn" id="zoomIn">+</button>
            <button class="zoom-btn" id="zoomOut">‚àí</button>
        </div>
    </div>

    <!-- „Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Éú„Çø„É≥ -->
    <div class="filter-overlay">
        <button class="filter-btn" id="filterBtn">„Éï„Ç£„É´„Çø„Éº</button>
        <div class="filter-panel" id="filterPanel">
            <div class="filter-title">„Çø„Ç∞„Åß„Éï„Ç£„É´„Çø„Éº</div>
            <div id="filterList"></div>
            <button class="filter-clear-btn" id="filterClearBtn">„Åô„Åπ„Å¶Ë°®Á§∫</button>
        </div>
    </div>

    <div class="modal" id="addSchoolModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">È´òÊ†°„ÇíËøΩÂä†</h2>
                <button class="close-btn" id="closeModal">√ó</button>
            </div>

            <div class="password-section">
                <p>üîí ÁÆ°ÁêÜËÄÖÂ∞ÇÁî®Ê©üËÉΩ</p>
                <div class="form-group">
                    <label for="password">„Éë„Çπ„ÉØ„Éº„Éâ *</label>
                    <input type="password" id="password" required placeholder="ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ">
                </div>
            </div>

            <form id="schoolForm">
                <div class="form-group">
                    <label for="schoolName">È´òÊ†°„ÅÆÂêçÂâç *</label>
                    <input type="text" id="schoolName" required placeholder="‰æã: „Äá„ÄáÈ´òÁ≠âÂ≠¶Ê†°">
                </div>
                
                <div class="form-group">
                    <label for="coordinates">Â∫ßÊ®ô (Á∑ØÂ∫¶, ÁµåÂ∫¶) *</label>
                    <input type="text" id="coordinates" required placeholder="‰æã: 34.648410, 134.991000">
                    <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">Google Map„ÅßÂè≥„ÇØ„É™„ÉÉ„ÇØ‚ÜíÂ∫ßÊ®ô„Çí„Ç≥„Éî„Éº„Åó„Å¶Ë≤º„Çä‰ªò„Åë</small>
                </div>
                
                <div class="form-group">
                    <label for="schoolDescription">ËªΩ„ÅÑÁ¥π‰ªãÊñá *</label>
                    <textarea id="schoolDescription" required placeholder="„Åì„ÅÆÈ´òÊ†°„ÅÆÁâπÂæ¥„ÇÑÈ≠ÖÂäõ„ÇíÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="schoolTags">„Çø„Ç∞</label>
                    <input type="text" id="schoolTags" placeholder="‰æã: ÁßÅÁ´ã,Â•≥Â≠êÊ†°,ÂêπÂ•èÊ•ΩÈÉ®">
                    <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">„Ç´„É≥„ÉûÔºà,Ôºâ„ÅßÂå∫Âàá„Å£„Å¶ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</small>
                </div>
                
                <div class="form-group">
                    <label for="youtubeUrl">YouTube„É™„É≥„ÇØ *</label>
                    <input type="url" id="youtubeUrl" required placeholder="https://www.youtube.com/watch?v=...">
                </div>
                
                <button type="button" class="submit-btn">ÁôªÈå≤„Åô„Çã</button>

                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>
            </form>
        </div>
    </div>

    <!-- „ÇØ„É©„Çπ„Çø„ÉºÂÜÖÂÆπË°®Á§∫„É¢„Éº„ÉÄ„É´ -->
    <div class="cluster-modal" id="clusterModal">
        <div class="cluster-modal-content">
            <div class="cluster-modal-header">
                <h3 id="clusterTitle">„Åì„ÅÆÂú∞Âüü„ÅÆÈ´òÊ†°</h3>
                <button class="close-cluster-modal" id="closeClusterModal">√ó</button>
            </div>
            <div class="cluster-modal-body" id="clusterList">
                <!-- „Éî„É≥„ÅÆ„É™„Çπ„Éà„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>
    
    <script>
        // ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ
        const ADMIN_PASSWORD = '114514';
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let map;
        let schools = [];
        let customIcon;
        let markerCluster; // „ÇØ„É©„Çπ„Çø„Éº„Ç∞„É´„Éº„Éó„ÇíËøΩÂä†
        let activeFilters = []; // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Éï„Ç£„É´„Çø„Éº

        // Âú∞Âõ≥„ÅÆÂàùÊúüÂåñ
        // Âú∞Âõ≥„ÅÆÂàùÊúüÂåñ
        function initMap() {
            console.log('Âú∞Âõ≥„ÇíÂàùÊúüÂåñ‰∏≠...');
            
            // localStorage„Åã„ÇâÂ≠¶Ê†°„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
            try {
                schools = JSON.parse(localStorage.getItem('marchingBandSchools') || '[]');
            } catch (e) {
                schools = [];
            }
            
            // „Ç´„Çπ„Çø„É†„Éû„Éº„Ç´„Éº„Ç¢„Ç§„Ç≥„É≥„Çí‰ΩúÊàêÔºà‰∏∏Âûã„Å´Â§âÊõ¥Ôºâ
            customIcon = L.divIcon({
                className: 'custom-marker',
                iconSize: [30, 30],
                iconAnchor: [15, 15],
                popupAnchor: [0, -15]
            });
            
            // Êó•Êú¨„ÅÆÂ¢ÉÁïå„ÇíÂÆöÁæ©
            const japanBounds = L.latLngBounds(
                L.latLng(24, 123),  // ÂçóË•ø„ÅÆËßíÔºàÊ≤ñÁ∏Ñ‰ªòËøëÔºâ
                L.latLng(46, 146)   // ÂåóÊù±„ÅÆËßíÔºàÂåóÊµ∑ÈÅì‰ªòËøëÔºâ
            );
            
            // Âú∞Âõ≥„Çí‰ΩúÊàê
            map = L.map('map', {
                zoomControl: false,
                preferCanvas: true,
                maxBounds: japanBounds,  // Êó•Êú¨„ÅÆÁØÑÂõ≤„Å´Âà∂Èôê
                maxBoundsViscosity: 0.8  // Â¢ÉÁïå„ÅÆÁ≤òÊÄßÔºà0-1„ÄÅ1„ÅßÂÆåÂÖ®„Å´Âà∂ÈôêÔºâ
            }).setView([36.5, 138], 5);

            // „Çø„Ç§„É´„É¨„Ç§„É§„Éº„ÇíËøΩÂä†
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18,
                minZoom: 5  // ÊúÄÂ∞è„Ç∫„Éº„É†„Çí5„Å´Â§âÊõ¥
            }).addTo(map);
            
            // „Éû„Éº„Ç´„Éº„ÇØ„É©„Çπ„Çø„Éº„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
            markerCluster = L.markerClusterGroup({
                maxClusterRadius: function(zoom) {
                    // „Ç∫„Éº„É†„É¨„Éô„É´„Å´Âøú„Åò„Å¶„ÇØ„É©„Çπ„Çø„ÉºÁØÑÂõ≤„ÇíÂãïÁöÑ„Å´Â§âÊõ¥
                    if (zoom >= 16) return 0;    // „Ç∫„Éº„É†16‰ª•‰∏ä: „ÇØ„É©„Çπ„Çø„É™„É≥„Ç∞ÁÑ°Âäπ
                    if (zoom >= 14) return 30;   // „Ç∫„Éº„É†14-15: 30px‰ª•ÂÜÖ
                    if (zoom >= 12) return 60;   // „Ç∫„Éº„É†12-13: 60px‰ª•ÂÜÖ
                    if (zoom >= 10) return 100;  // „Ç∫„Éº„É†10-11: 100px‰ª•ÂÜÖ
                    return 150;                  // „Ç∫„Éº„É†9‰ª•‰∏ã: 150px‰ª•ÂÜÖ
                },
                spiderfyOnMaxZoom: false,
                showCoverageOnHover: false,
                zoomToBoundsOnClick: false, // Ëá™Âãï„Ç∫„Éº„É†„ÇíÁÑ°ÂäπÂåñÔºàÊâãÂãï„ÅßÂà∂Âæ°Ôºâ
                animate: true,
                animateAddingMarkers: true,
                removeOutsideVisibleBounds: true,
                iconCreateFunction: function(cluster) {
                    const count = cluster.getChildCount();
                    const size = 50;
                    
                    return L.divIcon({
                        html: `<div style="
                            width: ${size}px;
                            height: ${size}px;
                            background: white;
                            border: 4px solid #10B981;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 16px;
                            font-weight: 700;
                            color: #059669;
                            font-family: 'Montserrat', sans-serif;
                            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
                        ">${count}</div>`,
                        className: 'custom-cluster-icon',
                        iconSize: L.point(size, size)
                    });
                }
            });
            
            // „ÇØ„É©„Çπ„Çø„Éº„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆ„Ç´„Çπ„Çø„É†Âá¶ÁêÜ
            let zoomCount = 0;
            markerCluster.on('clusterclick', function(a) {
                const cluster = a.layer;
                const childMarkers = cluster.getAllChildMarkers();
                
                // Â≠ê„Éû„Éº„Ç´„Éº„Åå1„Å§„Å†„Åë„ÅÆÂ†¥Âêà„ÅØ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíÈñã„Åè
                if (childMarkers.length === 1) {
                    childMarkers[0].openPopup();
                    return;
                }
                
                // „ÇØ„É©„Çπ„Çø„ÉºÂÜÖ„ÅÆÂÖ®„Å¶„ÅÆ„Éû„Éº„Ç´„Éº„ÅÆÂ¢ÉÁïå„ÇíÂèñÂæó
                const bounds = cluster.getBounds();
                
                // Â¢ÉÁïå„Å´Âêà„Çè„Åõ„Å¶„Ç∫„Éº„É†„Å®„Éë„É≥„ÇíÂÆüË°å
                // padding„ÇíË®≠ÂÆö„Åó„Å¶ÂÖ®„Å¶„ÅÆ„Éî„É≥„ÅåË¶ã„Åà„Çã„Çà„ÅÜ„Å´„Åô„Çã
                map.fitBounds(bounds, {
                    padding: [50, 50], // ‰∏ä‰∏ãÂ∑¶Âè≥„Å´50px„ÅÆ‰ΩôÁôΩ
                    maxZoom: 18,       // ÊúÄÂ§ß„Ç∫„Éº„É†„ÇíÂà∂Èôê
                    animate: true,
                    duration: 0.5
                });
            });
            
            // „Ç∫„Éº„É†„ÅåÂ§âÊõ¥„Åï„Çå„Åü„Çâ„Ç´„Ç¶„É≥„Çø„Éº„Çí„É™„Çª„ÉÉ„Éà
            map.on('zoomend', function() {
                const currentZoom = map.getZoom();
                if (currentZoom >= 16) {
                    zoomCount = 0;
                }
            });
            
            map.addLayer(markerCluster);

            console.log('Âú∞Âõ≥„ÅÆÂàùÊúüÂåñÂÆå‰∫Ü');

            // ‰øùÂ≠ò„Åï„Çå„ÅüÂ≠¶Ê†°„ÇíÂú∞Âõ≥„Å´Ë°®Á§∫
            schools.forEach(school => {
                addMarkerToMap(school);
            });
            
            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
            setupEventListeners();
        }

        // YouTubeÂãïÁîªID„ÇíÂèñÂæó
        function getYouTubeID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // YouTube„Çµ„É†„Éç„Ç§„É´URL„ÇíÂèñÂæó
        function getYouTubeThumbnail(videoId) {
            return `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
        }

        // ‰ΩèÊâÄ„Åã„ÇâÂ∫ßÊ®ô„ÇíÂèñÂæó
        async function geocodeAddress(address) {
            try {
                console.log('„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞APIÂëº„Å≥Âá∫„Åó:', address);
                
                // ÈÉµ‰æøÁï™Âè∑„Å®„Äå„Äí„ÄçË®òÂè∑„ÇíÂâäÈô§
                const cleanAddress = address.replace(/„Äí?\d{3}-?\d{4}\s*/g, '').trim();
                console.log('„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åó„Åü‰ΩèÊâÄ:', cleanAddress);
                
                const url = `https://geolonia.github.io/japanese-addresses/api/ja/${encodeURIComponent(cleanAddress)}.json`;
                console.log('„É™„ÇØ„Ç®„Çπ„ÉàURL:', url);
                
                const response = await fetch(url);
                console.log('„É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ:', response.status);
                
                if (!response.ok) {
                    console.log('API„Ç®„É©„Éº„ÄÅNominatim„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ');
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: Nominatim„ÇíË©¶„Åô
                    return await geocodeWithNominatim(cleanAddress);
                }
                
                const data = await response.json();
                console.log('„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞ÁµêÊûú:', data);
                
                if (data && data.geometry && data.geometry.coordinates) {
                    const coords = {
                        lat: data.geometry.coordinates[1],
                        lng: data.geometry.coordinates[0]
                    };
                    console.log('Â∫ßÊ®ôÂèñÂæóÊàêÂäü:', coords);
                    return coords;
                }
                
                console.log('ÁµêÊûú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                return null;
            } catch (error) {
                console.error('„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Ç®„É©„Éº:', error);
                return null;
            }
        }
        
        // Nominatim„Åß„ÅÆ„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞Ôºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁî®Ôºâ
        async function geocodeWithNominatim(address) {
            try {
                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&countrycodes=jp&limit=1`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon)
                    };
                }
                return null;
            } catch (error) {
                console.error('Nominatim„Ç®„É©„Éº:', error);
                return null;
            }
        }

        // „Éû„Éº„Ç´„Éº„ÇíÂú∞Âõ≥„Å´ËøΩÂä†
        function addMarkerToMap(school) {
            const marker = L.marker([school.lat, school.lng], { icon: customIcon });
            
            // „Éû„Éº„Ç´„Éº„Å´school„Éá„Éº„Çø„Çí‰øùÂ≠ò
            marker.schoolData = school;
            
            const videoId = getYouTubeID(school.youtubeUrl);
            const thumbnailUrl = videoId ? getYouTubeThumbnail(videoId) : '';
            
            console.log('YouTubeÂãïÁîªID:', videoId);
            console.log('„Çµ„É†„Éç„Ç§„É´URL:', thumbnailUrl);
            
            const popupContent = `
                <div class="popup-content">
                    <div class="popup-title">${school.name}</div>
                    ${school.tags && school.tags.length > 0 ? `
                        <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; margin-bottom: 10px;">
                            ${school.tags.map(tag => `
                                <span style="
                                    background: #F0FDF4;
                                    color: #059669;
                                    padding: 4px 10px;
                                    border-radius: 12px;
                                    font-size: 12px;
                                    font-weight: 600;
                                    border: 1px solid #10B981;
                                ">${tag}</span>
                            `).join('')}
                        </div>
                    ` : ''}
                    <div class="popup-description">${school.description}</div>
                    ${thumbnailUrl ? `
                        <a href="${school.youtubeUrl}" target="_blank" rel="noopener noreferrer" style="display: block; margin-top: 10px;">
                            <img src="${thumbnailUrl}" alt="YouTubeÂãïÁîª" class="popup-thumbnail">
                        </a>
                    ` : `
                        <a href="${school.youtubeUrl}" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none; display: block; margin-top: 10px;">
                            üì∫ YouTubeÂãïÁîª„ÇíË¶ã„Çã ‚Üí
                        </a>
                    `}
                </div>
            `;
            
            marker.bindPopup(popupContent, {
                maxWidth: 300,
                className: 'custom-popup',
                autoClose: true,
                closeOnClick: true
            });
            
            // „Éî„É≥„ÅÆ‰∏ã„Å´Â≠¶Ê†°Âêç„ÇíË°®Á§∫ÔºàÂ∏∏ÊôÇË°®Á§∫„ÅÆ„ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÔºâ
            marker.bindTooltip(school.name, {
                permanent: true,
                direction: 'bottom',
                offset: [0, 10],
                className: 'marker-label'
            });
            
            // „Éû„Éº„Ç´„Éº„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆÂâäÈô§„É¢„Éº„ÉâÂØæÂøú
            marker.on('click', function(e) {
                console.log('„Éû„Éº„Ç´„Éº„ÇØ„É™„ÉÉ„ÇØÊ§úÂá∫');
                const deleteMode = document.body.classList.contains('delete-mode');
                console.log('ÂâäÈô§„É¢„Éº„ÉâÁä∂ÊÖã:', deleteMode);
                
                if (deleteMode) {
                    // „Ç§„Éô„É≥„Éà‰ºùÊí≠„ÇíÂÆåÂÖ®„Å´ÂÅúÊ≠¢
                    if (e.originalEvent) {
                        e.originalEvent.preventDefault();
                        e.originalEvent.stopPropagation();
                    }
                    
                    // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíÈñã„Åã„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
                    marker.closePopup();
                    
                    console.log('ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åó„Åæ„Åô');
                    
                    // „Ç´„Çπ„Çø„É†ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
                    showDeleteConfirmModal(school, marker);
                    
                    return false;
                }
            });
            
            // „ÇØ„É©„Çπ„Çø„Éº„Ç∞„É´„Éº„Éó„Å´ËøΩÂä†
            markerCluster.addLayer(marker);
        }

        // ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showDeleteConfirmModal(school, marker) {
            const modal = document.getElementById('deleteConfirmModal');
            const message = document.getElementById('deleteConfirmMessage');
            const confirmBtn = document.getElementById('deleteConfirmBtn');
            const cancelBtn = document.getElementById('deleteCancelBtn');
            
            message.textContent = `„Äå${school.name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`;
            modal.classList.add('active');
            
            // Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§
            const newConfirmBtn = confirmBtn.cloneNode(true);
            const newCancelBtn = cancelBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
            
            // ÂâäÈô§Á¢∫ÂÆö„Éú„Çø„É≥
            newConfirmBtn.addEventListener('click', () => {
                console.log('ÂâäÈô§Âá¶ÁêÜÈñãÂßã');
                
                console.log('ÂâäÈô§Âá¶ÁêÜÈñãÂßã');
                
                // schools„Åã„ÇâÂâäÈô§
                const index = schools.findIndex(s => 
                    s.lat === school.lat && 
                    s.lng === school.lng && 
                    s.name === school.name
                );
                
                console.log('ÂâäÈô§ÂØæË±°„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ:', index);
                
                if (index > -1) {
                    schools.splice(index, 1);
                    localStorage.setItem('marchingBandSchools', JSON.stringify(schools));
                    console.log('ÂâäÈô§ÂÆå‰∫Ü:', school.name);
                    
                    // „Éû„Éº„Ç´„Éº„ÇíÂú∞Âõ≥„Åã„ÇâÂâäÈô§
                    markerCluster.removeLayer(marker);
                    console.log('„Éû„Éº„Ç´„Éº„ÇíÂú∞Âõ≥„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü');
                } else {
                    console.log('ÂâäÈô§ÂØæË±°„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }
                
                modal.classList.remove('active');
            });
            
            // „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥
            newCancelBtn.addEventListener('click', () => {
                console.log('ÂâäÈô§„Ç≠„É£„É≥„Çª„É´');
                modal.classList.remove('active');
            });
            
            // ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    console.log('ÂâäÈô§„Ç≠„É£„É≥„Çª„É´ÔºàËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØÔºâ');
                    modal.classList.remove('active');
                }
            });
        }

        // „Åô„Åπ„Å¶„ÅÆ„Çø„Ç∞„ÇíÂèñÂæó
        function getAllTags() {
            const tagsSet = new Set();
            schools.forEach(school => {
                if (school.tags && Array.isArray(school.tags)) {
                    school.tags.forEach(tag => tagsSet.add(tag));
                }
            });
            return Array.from(tagsSet).sort();
        }
        
        // „Çø„Ç∞„Åî„Å®„ÅÆÂ≠¶Ê†°Êï∞„ÇíÂèñÂæó
        function getSchoolCountByTag(tag) {
            return schools.filter(school => 
                school.tags && school.tags.includes(tag)
            ).length;
        }
        
        // „Éï„Ç£„É´„Çø„Éº„Éë„Éç„É´„ÇíÊõ¥Êñ∞
        function updateFilterPanel() {
            const filterList = document.getElementById('filterList');
            const allTags = getAllTags();
            
            if (allTags.length === 0) {
                filterList.innerHTML = '<div style="color: #9CA3AF; text-align: center; padding: 20px;">„Çø„Ç∞„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</div>';
                return;
            }
            
            filterList.innerHTML = '';
            
            allTags.forEach(tag => {
                const count = getSchoolCountByTag(tag);
                const isActive = activeFilters.includes(tag);
                
                const filterItem = document.createElement('div');
                filterItem.className = 'filter-item' + (isActive ? ' active' : '');
                filterItem.innerHTML = `
                    <div class="filter-checkbox"></div>
                    <div class="filter-label">${tag}</div>
                    <div class="filter-count">${count}</div>
                `;
                
                filterItem.addEventListener('click', (e) => {
                    e.stopPropagation(); // „Ç§„Éô„É≥„Éà‰ºùÊí≠„ÇíÂÅúÊ≠¢„Åó„Å¶„Éë„Éç„É´„ÅåÈñâ„Åò„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
                    toggleFilter(tag);
                });
                
                filterList.appendChild(filterItem);
            });
        }
        
        // „Éï„Ç£„É´„Çø„Éº„ÅÆÂàá„ÇäÊõø„Åà
        function toggleFilter(tag) {
            const index = activeFilters.indexOf(tag);
            
            if (index > -1) {
                // „Éï„Ç£„É´„Çø„ÉºËß£Èô§
                activeFilters.splice(index, 1);
            } else {
                // „Éï„Ç£„É´„Çø„ÉºËøΩÂä†
                activeFilters.push(tag);
            }
            
            updateFilterPanel();
            applyFilters();
        }
        
        // „Éï„Ç£„É´„Çø„Éº„ÇíÈÅ©Áî®
        function applyFilters() {
            // „ÇØ„É©„Çπ„Çø„Éº„Çí„ÇØ„É™„Ç¢
            markerCluster.clearLayers();
            
            // „Éï„Ç£„É´„Çø„ÉºÊù°‰ª∂„Å´Âêà„ÅÜÂ≠¶Ê†°„ÇíÂú∞Âõ≥„Å´Ë°®Á§∫
            schools.forEach(school => {
                // „Éï„Ç£„É´„Çø„Éº„Åå„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„Åô„Åπ„Å¶Ë°®Á§∫
                if (activeFilters.length === 0) {
                    addMarkerToMap(school);
                } else {
                    // Â≠¶Ê†°„ÅÆ„Çø„Ç∞„Åå„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éï„Ç£„É´„Çø„Éº„ÅÆ„ÅÑ„Åö„Çå„Åã„Å´‰∏ÄËá¥„Åô„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫
                    if (school.tags && school.tags.some(tag => activeFilters.includes(tag))) {
                        addMarkerToMap(school);
                    }
                }
            });
            
            console.log('„Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®:', activeFilters);
        }

        // „Éï„Ç©„Éº„É†„É™„Çª„ÉÉ„Éà
        function resetForm() {
            const schoolForm = document.getElementById('schoolForm');
            const errorMsg = document.getElementById('errorMessage');
            const successMsg = document.getElementById('successMessage');
            
            schoolForm.reset();
            document.getElementById('password').value = '';
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';
        }

        // „ÇØ„É©„Çπ„Çø„Éº„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showClusterModal(markers, clusterLatLng) {
            const modal = document.getElementById('clusterModal');
            const title = document.getElementById('clusterTitle');
            const listContainer = document.getElementById('clusterList');
            
            title.textContent = `„Åì„ÅÆÂú∞Âüü„ÅÆÈ´òÊ†°Ôºà${markers.length}Ê†°Ôºâ`;
            
            // „É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
            listContainer.innerHTML = '';
            
            // ÂêÑ„Éû„Éº„Ç´„Éº„ÅÆÂ≠¶Ê†°ÊÉÖÂ†±„ÇíË°®Á§∫
            markers.forEach(marker => {
                const school = schools.find(s => 
                    s.lat === marker.getLatLng().lat && 
                    s.lng === marker.getLatLng().lng
                );
                
                if (!school) return;
                
                const videoId = getYouTubeID(school.youtubeUrl);
                const thumbnailUrl = videoId ? getYouTubeThumbnail(videoId) : '';
                
                const item = document.createElement('div');
                item.className = 'cluster-school-item';
                item.innerHTML = `
                    <div class="cluster-school-name">${school.name}</div>
                    <div class="cluster-school-description">${school.description}</div>
                    ${thumbnailUrl ? `<img src="${thumbnailUrl}" class="cluster-school-thumbnail" alt="${school.name}">` : ''}
                `;
                
                // „ÇØ„É™„ÉÉ„ÇØ„Åß„Éû„Éº„Ç´„Éº„Å´ÁßªÂãï„Åó„Å¶„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíÈñã„Åè
                item.addEventListener('click', () => {
                    modal.classList.remove('active');
                    map.setView([school.lat, school.lng], 17, { animate: true });
                    setTimeout(() => {
                        marker.openPopup();
                    }, 500);
                });
                
                listContainer.appendChild(item);
            });
            
            modal.classList.add('active');
        }

        // „ÇØ„É©„Çπ„Çø„Éº„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('clusterModal');
            const closeBtn = document.getElementById('closeClusterModal');
            
            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
        function setupEventListeners() {
            const modal = document.getElementById('addSchoolModal');
            const closeModalBtn = document.getElementById('closeModal');
            const schoolForm = document.getElementById('schoolForm');
            const errorMsg = document.getElementById('errorMessage');
            const successMsg = document.getElementById('successMessage');

            console.log('„É¢„Éº„ÉÄ„É´:', modal);
            console.log('„Éï„Ç©„Éº„É†:', schoolForm);
            console.log('„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏:', errorMsg);
            console.log('ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏:', successMsg);

            // „É≠„Ç¥„ÇØ„É™„ÉÉ„ÇØ„Åß„Éõ„Éº„É†„Å´Êàª„Çã
            const logoHome = document.getElementById('logoHome');
            const whiteFlash = document.getElementById('whiteFlash');
            
            logoHome.addEventListener('click', () => {
                // ÁôΩ„Éï„É©„ÉÉ„Ç∑„É•„Ç®„Éï„Çß„ÇØ„Éà
                whiteFlash.classList.add('active');
                
                setTimeout(() => {
                    // Âú∞Âõ≥„ÇíÂàùÊúü‰ΩçÁΩÆ„Å´Êàª„Åô
                    map.setView([36.5, 138], 5, {
                        animate: true,
                        duration: 1
                    });
                    
                    // „Éï„É©„ÉÉ„Ç∑„É•„ÇíÊ∂à„Åô
                    setTimeout(() => {
                        whiteFlash.classList.remove('active');
                    }, 150);
                }, 150);
            });

            // ÂâäÈô§„É¢„Éº„Éâ„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ
            let deleteMode = false;
            const deleteModeIndicator = document.getElementById('deleteModeIndicator');
            const passwordConfirmModal = document.getElementById('passwordConfirmModal');
            const passwordConfirmInput = document.getElementById('passwordConfirmInput');
            const passwordConfirmError = document.getElementById('passwordConfirmError');
            const passwordConfirmBtn = document.getElementById('passwordConfirmBtn');
            const passwordCancelBtn = document.getElementById('passwordCancelBtn');

            // „Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            function showPasswordConfirmModal() {
                passwordConfirmModal.classList.add('active');
                passwordConfirmInput.value = '';
                passwordConfirmError.classList.remove('active');
                passwordConfirmInput.focus();
            }

            // „Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            function closePasswordConfirmModal() {
                passwordConfirmModal.classList.remove('active');
                passwordConfirmInput.value = '';
                passwordConfirmError.classList.remove('active');
            }

            // „Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç„Éú„Çø„É≥
            passwordConfirmBtn.addEventListener('click', () => {
                const password = passwordConfirmInput.value;
                
                if (password === ADMIN_PASSWORD) {
                    // „Éë„Çπ„ÉØ„Éº„ÉâÊ≠£Ëß£„ÅßÂâäÈô§„É¢„Éº„ÉâON
                    deleteMode = true;
                    deleteModeIndicator.classList.add('active');
                    document.body.classList.add('delete-mode');
                    console.log('ÂâäÈô§„É¢„Éº„Éâ: ON');
                    closePasswordConfirmModal();
                } else {
                    // „Éë„Çπ„ÉØ„Éº„Éâ‰∏çÊ≠£Ëß£
                    passwordConfirmError.classList.add('active');
                    passwordConfirmInput.value = '';
                    passwordConfirmInput.focus();
                    console.log('ÂâäÈô§„É¢„Éº„Éâ: „Éë„Çπ„ÉØ„Éº„Éâ„Ç®„É©„Éº');
                }
            });

            // „Éë„Çπ„ÉØ„Éº„Éâ„Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥
            passwordCancelBtn.addEventListener('click', () => {
                closePasswordConfirmModal();
                console.log('ÂâäÈô§„É¢„Éº„Éâ: „Ç≠„É£„É≥„Çª„É´');
            });

            // Enter„Ç≠„Éº„Åß„Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç
            passwordConfirmInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    passwordConfirmBtn.click();
                }
            });

            // ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
            passwordConfirmModal.addEventListener('click', (e) => {
                if (e.target === passwordConfirmModal) {
                    closePasswordConfirmModal();
                }
            });

            // Ctrl+Shift+A „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
            // Ctrl+Shift+D „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„Éº„ÅßÂâäÈô§„É¢„Éº„Éâ„ÇíÂàá„ÇäÊõø„Åà
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    modal.classList.add('active');
                }
                
                if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                    e.preventDefault();
                    
                    // ÂâäÈô§„É¢„Éº„Éâ„ÇíON„Å´„Åô„ÇãÂ†¥Âêà„ÅØ„Éë„Çπ„ÉØ„Éº„ÉâÁ¢∫Ë™ç
                    if (!deleteMode) {
                        showPasswordConfirmModal();
                    } else {
                        // ÂâäÈô§„É¢„Éº„ÉâOFFÔºà„Éë„Çπ„ÉØ„Éº„Éâ‰∏çË¶ÅÔºâ
                        deleteMode = false;
                        deleteModeIndicator.classList.remove('active');
                        document.body.classList.remove('delete-mode');
                        console.log('ÂâäÈô§„É¢„Éº„Éâ: OFF');
                    }
                }
            });

            // „É¢„Éº„ÉÄ„É´Êìç‰Ωú
            closeModalBtn.addEventListener('click', () => {
                modal.classList.remove('active');
                resetForm();
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    resetForm();
                }
            });

            // „Ç∫„Éº„É†„Éú„Çø„É≥
            document.getElementById('zoomIn').addEventListener('click', () => {
                map.zoomIn();
            });

            document.getElementById('zoomOut').addEventListener('click', () => {
                map.zoomOut();
            });

            // „Éï„Ç£„É´„Çø„Éº„Éú„Çø„É≥
            const filterBtn = document.getElementById('filterBtn');
            const filterPanel = document.getElementById('filterPanel');
            const filterClearBtn = document.getElementById('filterClearBtn');
            
            filterBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // „Ç§„Éô„É≥„Éà‰ºùÊí≠„ÇíÂÅúÊ≠¢
                filterPanel.classList.toggle('active');
                updateFilterPanel();
            });
            
            // „Éï„Ç£„É´„Çø„Éº„ÇØ„É™„Ç¢„Éú„Çø„É≥
            filterClearBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // „Ç§„Éô„É≥„Éà‰ºùÊí≠„ÇíÂÅúÊ≠¢
                activeFilters = [];
                updateFilterPanel();
                applyFilters();
            });
            
            // „Éë„Éç„É´Â§ñ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„ÇâÈñâ„Åò„Çã
            document.addEventListener('click', (e) => {
                if (!filterBtn.contains(e.target) && !filterPanel.contains(e.target)) {
                    filterPanel.classList.remove('active');
                }
            });

            // ÁôªÈå≤„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            const submitBtn = document.querySelector('.submit-btn');
            console.log('ÁôªÈå≤„Éú„Çø„É≥:', submitBtn);
            
            submitBtn.addEventListener('click', async (e) => {
                console.log('ÁôªÈå≤„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
                
                errorMsg.style.display = 'none';
                successMsg.style.display = 'none';
                
                // „Éë„Çπ„ÉØ„Éº„ÉâÊ§úË®º
                const password = document.getElementById('password').value;
                if (password !== ADMIN_PASSWORD) {
                    errorMsg.textContent = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì';
                    errorMsg.style.display = 'block';
                    console.log('„Éë„Çπ„ÉØ„Éº„Éâ„Ç®„É©„Éº');
                    return;
                }
                
                const name = document.getElementById('schoolName').value.trim();
                const coordinatesInput = document.getElementById('coordinates').value.trim();
                const description = document.getElementById('schoolDescription').value.trim();
                const tagsInput = document.getElementById('schoolTags').value.trim();
                const youtubeUrl = document.getElementById('youtubeUrl').value.trim();
                
                // „Çø„Ç∞„ÇíÈÖçÂàó„Å´ÂàÜÂâ≤Ôºà„Ç´„É≥„Éû„ÅßÂå∫Âàá„ÇãÔºâ
                const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0) : [];
                
                console.log('ÂÖ•Âäõ„Éá„Éº„Çø:', { name, coordinatesInput, description, tags, youtubeUrl });
                
                // Â∫ßÊ®ô„ÇíÂàÜÈõ¢Ôºà„Ç´„É≥„Éû„ÄÅ„Çπ„Éö„Éº„Çπ„ÄÅ„Çø„Éñ„Å™„Å©„ÅßÂå∫Âàá„Çâ„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„Å´ÂØæÂøúÔºâ
                const coordParts = coordinatesInput.split(/[,\s]+/).filter(p => p.length > 0);
                
                if (coordParts.length < 2) {
                    errorMsg.textContent = 'Â∫ßÊ®ô„ÅØ„ÄåÁ∑ØÂ∫¶, ÁµåÂ∫¶„Äç„ÅÆÂΩ¢Âºè„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æã: 34.648410, 134.991000Ôºâ';
                    errorMsg.style.display = 'block';
                    console.log('Â∫ßÊ®ô„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Ç®„É©„Éº:', coordParts);
                    return;
                }
                
                // Á∑ØÂ∫¶„Åå1Áï™ÁõÆ„ÄÅÁµåÂ∫¶„Åå2Áï™ÁõÆ
                const lat = parseFloat(coordParts[0]);
                const lng = parseFloat(coordParts[1]);
                
                console.log('ÂàÜÈõ¢„Åó„ÅüÂ∫ßÊ®ô:', { lat, lng });
                
                if (isNaN(lat) || isNaN(lng)) {
                    errorMsg.textContent = 'Á∑ØÂ∫¶„ÉªÁµåÂ∫¶„ÅØÊï∞ÂÄ§„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    errorMsg.style.display = 'block';
                    console.log('Â∫ßÊ®ôÊï∞ÂÄ§„Ç®„É©„Éº');
                    return;
                }
                
                if (lat < 24 || lat > 46 || lng < 123 || lng > 146) {
                    errorMsg.textContent = 'Â∫ßÊ®ô„ÅåÊó•Êú¨„ÅÆÁØÑÂõ≤Â§ñ„Åß„Åô„ÄÇÊ≠£„Åó„ÅÑÂ∫ßÊ®ô„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    errorMsg.style.display = 'block';
                    console.log('Â∫ßÊ®ôÁØÑÂõ≤„Ç®„É©„Éº');
                    return;
                }
                
                // YouTube URL„ÅÆÊ§úË®º
                if (!getYouTubeID(youtubeUrl)) {
                    errorMsg.textContent = 'ÊúâÂäπ„Å™YouTube URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    errorMsg.style.display = 'block';
                    console.log('YouTube URL„Ç®„É©„Éº');
                    return;
                }
                
                // Â≠¶Ê†°„Éá„Éº„Çø„Çí‰ΩúÊàê
                const school = {
                    name,
                    lat,
                    lng,
                    description,
                    tags,
                    youtubeUrl,
                    createdAt: new Date().toISOString()
                };
                
                console.log('Â≠¶Ê†°„Éá„Éº„Çø‰ΩúÊàê:', school);
                
                // „Éá„Éº„Çø„Çí‰øùÂ≠ò
                schools.push(school);
                localStorage.setItem('marchingBandSchools', JSON.stringify(schools));
                console.log('„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠òÂÆå‰∫Ü');
                
                // „Éû„Éº„Ç´„Éº„ÇíËøΩÂä†
                addMarkerToMap(school);
                console.log('„Éû„Éº„Ç´„ÉºËøΩÂä†ÂÆå‰∫Ü');
                
                // „Éï„Ç£„É´„Çø„Éº„Éë„Éç„É´„ÇíÊõ¥Êñ∞
                updateFilterPanel();
                
                // Âú∞Âõ≥„Çí„Åù„ÅÆ‰ΩçÁΩÆ„Å´ÁßªÂãï
                map.setView([lat, lng], 12);
                
                // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
                successMsg.textContent = `${name}„ÇíÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºÅ`;
                successMsg.style.display = 'block';
                console.log('ÁôªÈå≤ÂÆå‰∫Ü');
                
                setTimeout(() => {
                    modal.classList.remove('active');
                    resetForm();
                }, 2000);
            });

        }
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´Âú∞Âõ≥„ÇíÂàùÊúüÂåñ
        window.addEventListener('load', function() {
            console.log('„Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
            setTimeout(initMap, 100);
        });
    </script>
</body>
</html>